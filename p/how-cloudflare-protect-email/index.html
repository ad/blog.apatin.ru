<!doctype html><html class=no-js itemscope itemtype=http://schema.org/Product><head><meta charset=utf-8><title>Как Cloudflare защищает email - Weblog</title><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=og:title content="Как Cloudflare защищает email - Weblog"><meta property="og:image" content="/static/favicon.png"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><link rel="shortcut icon" href=../../static/favicon.ico type=image/x-icon><link rel=apple-touch-icon href=../../static/favicon.ico><link rel=stylesheet href=../../css/main.min.157c034e55c30a3033be80b8464d3375bb6cb8a04d8ee6c6e102071ec1624345.css integrity="sha256-FXwDTlXDCjAzvoC4Rk0zdbtsuKBNjubG4QIHHsFiQ0U=" media=screen><script type=text/javascript>(function(d,w,c){(w[c]=w[c]||[]).push(function(){try{w.yaCounter21943429=new Ya.Metrika({id:21943429,webvisor:true,clickmap:true,accurateTrackBounce:true});}catch(e){}});var n=d.getElementsByTagName("script")[0],s=d.createElement("script"),f=function(){n.parentNode.insertBefore(s,n);};s.type="text/javascript";s.async=true;s.src=(d.location.protocol=="https:"?"https:":"http:")+"//mc.yandex.ru/metrika/watch.js";if(w.opera=="[object Opera]"){d.addEventListener("DOMContentLoaded",f,false);}else{f();}})(document,window,"yandex_metrika_callbacks");</script><link rel=prev id=link-earlier href=../../p/github-actions-go-release/><link rel=next id=link-later href=../../p/to-gh-pages/></head><body><div class=common><div class=flag><div class=header-content><div class=header-description><div class=title><div class=title-inner><div class=logo-marginal><div class=e2-user-picture-container><img alt=Logo title=Logo src=../../static/favicon.png></div></div><h1><a href=../../><span id=e2-blog-title style=font-size:48px>Weblog</span></a></h1></div><div id=e2-blog-description><p>Личный блог с мыслями и наблюдениями</p></div></div></div></div></div><div class=content><div id=e2-note-6 class=e2-note><article><h1 class="e2-published e2-smart-title"><a href=../../p/how-cloudflare-protect-email/>Как Cloudflare защищает email</a></h1><div class="e2-note-text e2-text e2-published"><p>Как опубликовать адрес электронной почты на сайте, не боясь, что в него тут же начнут валиться горы спама?</p><p>В большинстве случаев эту задачу решают так: вставка адреса картинкой; написание особым способом, который читатели сайта смогут расшифровать (не всегда); форма для ввода текста письма. Разберём плюсы и минусы каждого.</p><h2 id=вставка-адреса-картинкой>Вставка адреса картинкой</h2><p>[+] большинство ботов не читают тексты с картинки</p><p>[-] оформление картинки нужно как-то вписать в контекст</p><p>[-] картинку нужно хранить и беречь</p><p>[-] не получится создать письмо по нажатию на картинку</p><h2 id=написание-особым-способом>Написание особым способом</h2><p>[+] скорее всего боты не смогут понять что это адрес электронной почты</p><p>[-] как и некоторые посетители сайта: help 911 (собака) mail com (замените пробелы на точки)</p><p>[-] боты всё же умеют разбирать большинство таких &ldquo;шифровок&rdquo;</p><h2 id=форма-для-ввода-текста-письма>Форма для ввода текста письма</h2><p>[+] ваша почта явно не указана</p><p>[-] форма ввода текста — источник для спама (популярные капчи тоже разгадываются)</p><p>[-] разработка и поддержка формы ввода письма</p><p>[-] люди могут не хотеть писать в некую форму, не зная получит ли нужный человек письмо</p><p>Есть ли способ замаскировать почту так, чтобы и посетителям было удобно и боты на неё не обращали внимания?</p><p><em>Cloudflare Email Address Obfuscation</em> позволяет подменять адреса на html-страничках таким образом, чтобы они перестали быть понятными ботам.</p><p><a href=#><span class=__email__ data-class=472f222b37697e7676072a262e2b6924282a>[email&nbsp;protected]</span></a>
-> 472f222b37697e7676072a262e2b6924282a</p><p><strong>Откройте исходный код страницы и убедитесь, что там нет адреса электронной почты!</strong></p><p>Если интересно как работает этот способ и как сделать аналогичное решение у себя, читайте дальше.</p><p>В основе лежит шифр Вернама — система симметричного шифрования, изобретённая в 1917 году сотрудником AT&T Гилбертом Вернамом. В нём используется булева функция «Исключающее ИЛИ» (bitwise xor). Шифр Вернама является примером системы с абсолютной криптографической стойкостью. При этом он считается одной из простейших криптосистем.</p><p>Для  создания зашифрованной строки: генерируется случайное символ-число(секрет), берется последовательность символов, которые нужно зашифровать и к каждому из них применяется &ldquo;исключающее ИЛИ&rdquo; с секретом.</p><p>Рассмотрим на примере выше, как из email получилась такая строка:</p><ol><li>сгенерировали случайное число из диапазона печатных символов ASCII c 65 по 90 символ (A-Z): получилось 71 (это символ G) имеет значение 47 в шестнадцатеричной системе счисления</li><li>записали 47 в результат</li><li>затем применили к первой букве шифруемой строки исключающее ИЛИ, символ &ldquo;h&rdquo; имеет код 104, применив к нему XOR и 71 получаем 47, это в шестнадцатеричной системе будет 2f</li><li>записываем 2f в результат</li></ol><p>&mldr; применяем шаги 3 и 4 к оставшимся символам</p><p>Х. получаем <code>472f222b37697e7676072a262e2b6924282a</code></p><pre><code>func encode(a string) (s string) {
    b := int64(65 + rand.Intn(35))
    s += strconv.FormatInt(b, 16)
    for _, d := range []rune(a) {
    r := strconv.FormatInt(b^int64(d), 16)
        if len(r)%2!=0 {
            r = &quot;0&quot;+r
        }
        s += r
    }
    return
}
</code></pre><p>Для процесса расшифровки действуем в обратном порядке:</p><ol><li>считываем первые два символа, это будет 47, из которого после преобразования из шестнадцатеричной системы в десятичную получаем 71 — это будет наш ключ</li><li>считываем следующие два символа, это будет 2f, преобразуем к десятичной системе и получаем 47</li><li>применяем к 47 XOR 71, таким образом получаем 104, а это код буквы h</li><li>считываем следующие два символа, это будет 22, преобразуем к десятичной системе и получаем 34</li><li>применяем к 34 XOR 71, таким образом получаем 101, а это код буквы e</li></ol><p>&mldr; и так далее.</p><pre><code>func decode(a string) (s string) {
    r, _ := strconv.ParseInt(a[0:2], 16, 0)
    for n := 4; n &lt; len(a)+2; n += 2 {
        i, _ := strconv.ParseInt(a[n-2:n], 16, 0)
        s += string(i ^ r)
    }
    return
}
</code></pre><p>Остаётся добавить код на страницу и email будет в относительной безопасности:</p><pre><code>&lt;a href=&quot;#&quot;&gt;&lt;span class=&quot;__email__&quot; data-class=&quot;472f222b37697e7676072a262e2b6924282a&quot;&gt;[email&amp;nbsp;protected]&lt;/span&gt;&lt;/a&gt;

&lt;script type=&quot;text/javascript&quot;&gt;
      Array.from(document.getElementsByClassName(&quot;__email__&quot;)).forEach(
        function(l, index, array) {
            var a = l.getAttribute(&quot;data-class&quot;);
            if (a) {
              var s = '';
              var r = parseInt(a.substr(0, 2), 16);

              for (var j = 2; a.length - j; j += 2) {
                var c = parseInt(a.substr(j, 2), 16) ^ r;
                s += String.fromCharCode(c);
              }
              l.parentNode.href = &quot;mailto:&quot;+s;
              l.parentNode.innerText = s;
            }
        }
    );
&lt;/script&gt;
</code></pre></div></article><div class=e2-note-tags><span class=e2-timestamp>26.04.2020</span> &nbsp;
<a href=//t/%D1%82%D0%B5%D1%85%D0%BD%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%BE%D0%B5 class=e2-tag>техническое</a> &nbsp;
<a href=//t/go class=e2-tag>go</a> &nbsp;
<a href=//t/cloudflare class=e2-tag>cloudflare</a> &nbsp;
<a href=//t/javascript class=e2-tag>javascript</a> &nbsp;
<a href=//t/email class=e2-tag>email</a> &nbsp;
<a href=//t/vernam class=e2-tag>Vernam</a> &nbsp;
<a href=//t/%D1%88%D0%B8%D1%84%D1%80 class=e2-tag>шифр</a> &nbsp;</div></div><div class=e2-pages><a href=../../p/github-actions-go-release/>Ранее</a>
<span class=e2-keyboard-shortcut>↓</span>
<span class=e2-keyboard-shortcut>⌥</span>
<span class=e2-keyboard-shortcut>↑</span>
<a href=../../p/to-gh-pages/>Позднее</a></div><h4 class=page-header>Рекомендуемые посты:</h4><div id=e2-note-6><a href=../../p/to-gh-pages/><h5 class="e2-published e2-smart-title" style=font-size:18px>Переезд на Github Pages</h5></a><div class=e2-note-tags><span class=e2-timestamp>31.01.2021</span></div></div><br><div id=e2-note-6><a href=../../p/github-actions-go-release/><h5 class="e2-published e2-smart-title" style=font-size:18px>Github Actions и автоматическое создание релизов на Go</h5></a><div class=e2-note-tags><span class=e2-timestamp>27.09.2019</span></div></div><br></div><div class=footer>&copy;
<span id=e2-blog-author>Daniel Apatin</span>,
2008—2021
<a href=../../rss.xml type=application/rss+xml target=_blank class=e2-rss-button>RSS</a>
<a class=e2-rss-button href=../../tags/>Теги</a></div></div><script type=text/javascript>(function(d,w,c){(w[c]=w[c]||[]).push(function(){try{w.yaCounter21943429=new Ya.Metrika({id:21943429,webvisor:true,clickmap:true,accurateTrackBounce:true});}catch(e){}});var n=d.getElementsByTagName("script")[0],s=d.createElement("script"),f=function(){n.parentNode.insertBefore(s,n);};s.type="text/javascript";s.async=true;s.src=(d.location.protocol=="https:"?"https:":"http:")+"//mc.yandex.ru/metrika/watch.js";if(w.opera=="[object Opera]"){d.addEventListener("DOMContentLoaded",f,false);}else{f();}})(document,window,"yandex_metrika_callbacks");document.addEventListener("DOMContentLoaded",function(){var lazyImages=[].slice.call(document.querySelectorAll("img.lazy"));if("IntersectionObserver"in window){let lazyImageObserver=new IntersectionObserver(function(entries,observer){entries.forEach(function(entry){if(entry.isIntersecting){let lazyImage=entry.target;lazyImage.src=lazyImage.dataset.src;lazyImage.classList.remove("lazy");lazyImageObserver.unobserve(lazyImage);}});});lazyImages.forEach(function(lazyImage){lazyImageObserver.observe(lazyImage);});}else{}});Array.from(document.getElementsByClassName("__email__")).forEach(function(l,index,array){var a=l.getAttribute("data-class");if(a){var s='';var r=parseInt(a.substr(0,2),16);for(var j=2;a.length-j;j+=2){var c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}
l.parentNode.href="mailto:"+s;l.parentNode.innerText=s;}});</script></body><ok></html>